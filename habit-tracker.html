<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<title>Today's Flow</title>
<style>
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    -webkit-tap-highlight-color: transparent;
  }

  body {
    min-height: 100vh;
    min-height: 100dvh;
    background: #0f172a;
    font-family: Georgia, 'Times New Roman', serif;
    color: #cbd5e1;
    padding: 56px 16px 40px;
    position: relative;
    overflow-x: hidden;
  }

  /* Ambient blobs */
  .blob {
    position: fixed;
    border-radius: 50%;
    pointer-events: none;
    z-index: 0;
  }
  .blob-1 {
    top: -120px; left: -120px;
    width: 300px; height: 300px;
    background: radial-gradient(circle, rgba(245,158,11,0.12) 0%, transparent 70%);
  }
  .blob-2 {
    bottom: -100px; right: -100px;
    width: 280px; height: 280px;
    background: radial-gradient(circle, rgba(99,102,241,0.12) 0%, transparent 70%);
  }

  .container {
    position: relative;
    z-index: 1;
    max-width: 480px;
    margin: 0 auto;
  }

  /* Header */
  .header {
    text-align: center;
    margin-bottom: 28px;
  }
  .header h1 {
    color: #f1f5f9;
    font-size: 28px;
    font-weight: normal;
    letter-spacing: 0.04em;
    margin-bottom: 6px;
  }
  .header .date {
    color: #64748b;
    font-size: 13px;
    letter-spacing: 0.08em;
    text-transform: uppercase;
  }

  /* Overall progress */
  .progress-box {
    background: #1e293b;
    border-radius: 14px;
    padding: 16px 18px;
    margin-bottom: 24px;
    border: 1px solid rgba(148,163,184,0.08);
  }
  .progress-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
  }
  .progress-label {
    color: #94a3b8;
    font-size: 13px;
    letter-spacing: 0.04em;
  }
  .progress-value {
    color: #f1f5f9;
    font-size: 14px;
    font-weight: bold;
    letter-spacing: 0.02em;
  }
  .progress-value.complete { color: #4ade80; }
  .progress-track {
    background: #0f172a;
    border-radius: 8px;
    height: 8px;
    overflow: hidden;
  }
  .progress-fill {
    height: 100%;
    width: 0%;
    border-radius: 8px;
    background: linear-gradient(90deg, #f59e0b, #3b82f6, #6366f1);
    transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
  }
  .progress-fill.complete {
    background: linear-gradient(90deg, #4ade80, #22c55e);
  }

  /* Cards */
  .card {
    background: #1e293b;
    border-radius: 18px;
    margin-bottom: 16px;
    border: 1px solid rgba(148,163,184,0.08);
    overflow: hidden;
    transition: background 0.4s ease, border-color 0.4s ease;
  }
  .card.complete {
    background: rgba(74,222,128,0.06);
    border-color: rgba(74,222,128,0.25);
  }

  .card-header {
    padding: 14px 18px;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }
  .card-header-left {
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .card-emoji { font-size: 22px; }
  .card-title {
    color: #fff;
    font-size: 16px;
    font-weight: normal;
    letter-spacing: 0.03em;
  }
  .card-count {
    color: rgba(255,255,255,0.85);
    font-size: 12px;
    background: rgba(0,0,0,0.2);
    padding: 3px 10px;
    border-radius: 12px;
    letter-spacing: 0.04em;
  }

  /* Task list */
  .task-list { padding: 8px 0; }

  .task-item {
    display: flex;
    align-items: center;
    padding: 10px 18px;
    gap: 12px;
    border-bottom: 1px solid rgba(148,163,184,0.06);
    transition: background 0.2s ease;
    cursor: pointer;
  }
  .task-item:last-of-type { border-bottom: none; }
  .task-item:active { background: rgba(148,163,184,0.06); }

  .task-checkbox {
    width: 22px;
    height: 22px;
    border-radius: 6px;
    border: 2px solid var(--accent);
    background: transparent;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    transition: all 0.2s ease;
  }
  .task-checkbox.checked {
    background: var(--accent);
    border-color: var(--accent);
    box-shadow: 0 0 8px var(--accent-glow);
  }
  .task-checkbox svg { display: none; }
  .task-checkbox.checked svg { display: block; }

  .task-text {
    color: #cbd5e1;
    font-size: 14px;
    flex: 1;
    letter-spacing: 0.01em;
    transition: color 0.2s ease;
    user-select: none;
  }
  .task-item.done .task-text {
    color: #475569;
    text-decoration: line-through;
  }

  .task-delete {
    color: #475569;
    font-size: 20px;
    line-height: 1;
    cursor: pointer;
    padding: 2px 6px;
    border-radius: 4px;
    opacity: 0.5;
    transition: color 0.15s, opacity 0.15s;
    flex-shrink: 0;
  }
  .task-delete:active {
    color: #ef4444;
    opacity: 1;
  }

  /* Add task */
  .add-task-btn {
    padding: 11px 18px;
    color: #475569;
    font-size: 13px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    letter-spacing: 0.04em;
    font-family: Georgia, serif;
    background: none;
    border: none;
    width: 100%;
    text-align: left;
    transition: color 0.2s ease;
  }
  .add-task-btn:active { color: var(--accent); }
  .add-task-btn .plus { font-size: 16px; }

  .add-task-form {
    padding: 10px 18px 14px;
    display: flex;
    gap: 8px;
    align-items: center;
  }
  .add-task-input {
    flex: 1;
    background: #0f172a;
    border: 1px solid var(--accent-mid);
    border-radius: 8px;
    padding: 8px 12px;
    color: #f1f5f9;
    font-size: 14px;
    font-family: Georgia, serif;
    letter-spacing: 0.01em;
    outline: none;
    -webkit-appearance: none;
  }
  .add-task-input:focus {
    border-color: var(--accent);
  }
  .btn-add {
    background: var(--gradient);
    border: none;
    border-radius: 8px;
    padding: 8px 14px;
    color: #fff;
    font-size: 13px;
    font-family: Georgia, serif;
    letter-spacing: 0.04em;
    cursor: pointer;
    white-space: nowrap;
  }
  .btn-cancel {
    background: transparent;
    border: 1px solid rgba(148,163,184,0.2);
    border-radius: 8px;
    padding: 8px 10px;
    color: #64748b;
    font-size: 14px;
    cursor: pointer;
    line-height: 1;
  }

  /* Footer */
  .footer {
    text-align: center;
    margin-top: 32px;
  }
  .footer p {
    color: #334155;
    font-size: 12px;
    letter-spacing: 0.06em;
  }
</style>
</head>
<body>

<div class="blob blob-1"></div>
<div class="blob blob-2"></div>

<div class="container">
  <div class="header">
    <h1>Today's Flow</h1>
    <div class="date" id="dateDisplay"></div>
  </div>

  <div class="progress-box">
    <div class="progress-header">
      <span class="progress-label">Overall Progress</span>
      <span class="progress-value" id="progressValue">0%</span>
    </div>
    <div class="progress-track">
      <div class="progress-fill" id="progressFill"></div>
    </div>
  </div>

  <div id="cardsContainer"></div>

  <div class="footer">
    <p>Resets automatically each day</p>
  </div>
</div>

<script>
const CARDS_CONFIG = [
  {
    id: "rise",
    title: "Rise & Shine",
    emoji: "ðŸŒ…",
    gradient: "linear-gradient(135deg, #f59e0b, #f97316)",
    accent: "#f59e0b",
    accentMid: "rgba(245,158,11,0.4)",
    accentGlow: "rgba(245,158,11,0.3)",
    defaultTasks: [
      { text: "Get up" },
      { text: "Coffee" },
      { text: "Get baby up" },
      { text: "Change diaper" },
      { text: "Pick out outfit" },
      { text: "Shower" },
      { text: "Brush teeth" },
      { text: "Eat breakfast" },
      { text: "Get dressed" },
      { text: "Start the car" },
      { text: "Keys, wallet, phone" }
    ]
  },
  {
    id: "diaper",
    title: "Diaper Bag Items",
    emoji: "ðŸŽ’",
    gradient: "linear-gradient(135deg, #ec4899, #a855f7)",
    accent: "#ec4899",
    accentMid: "rgba(236,72,153,0.4)",
    accentGlow: "rgba(236,72,153,0.3)",
    defaultTasks: [
      { text: "Extra outfit" },
      { text: "4 bottles" },
      { text: "1 pouch" },
      { text: "Sleep sack" },
      { text: "Sheets" },
      { text: "Diapers & wipes" },
      { text: "Snowsuit" }
    ]
  },
  {
    id: "grind",
    title: "The Grind",
    emoji: "âš¡",
    gradient: "linear-gradient(135deg, #3b82f6, #6366f1)",
    accent: "#3b82f6",
    accentMid: "rgba(59,130,246,0.4)",
    accentGlow: "rgba(59,130,246,0.3)",
    defaultTasks: [
      { text: "Check calendar / meetings" },
      { text: "Answer emails" },
      { text: "Squad Jira tickets" }
    ]
  },
  {
    id: "turndown",
    title: "Turndown",
    emoji: "ðŸŒ™",
    gradient: "linear-gradient(135deg, #6366f1, #8b5cf6)",
    accent: "#6366f1",
    accentMid: "rgba(99,102,241,0.4)",
    accentGlow: "rgba(99,102,241,0.3)",
    defaultTasks: [
      { text: "Feed baby dinner" },
      { text: "Give baby bath" },
      { text: "Put baby in PJs" },
      { text: "Get water bottle" },
      { text: "Wash face" },
      { text: "Take contacts out" },
      { text: "Put glasses on" }
    ]
  }
];

function getTodayString() {
  return new Date().toISOString().split("T")[0];
}

function generateId() {
  return "task-" + Date.now() + "-" + Math.random().toString(36).slice(2, 7);
}

function getInitialCards() {
  return CARDS_CONFIG.map(cfg => ({
    id: cfg.id,
    title: cfg.title,
    emoji: cfg.emoji,
    gradient: cfg.gradient,
    accent: cfg.accent,
    accentMid: cfg.accentMid,
    accentGlow: cfg.accentGlow,
    tasks: cfg.defaultTasks.map(t => ({ id: generateId(), text: t.text, done: false }))
  }));
}

function loadState() {
  const storedDate = localStorage.getItem("ht-date");
  const storedData = localStorage.getItem("ht-data");
  const today = getTodayString();

  console.log("Stored date:", storedDate, "Today:", today);

  if (storedDate && storedData) {
    let cards = JSON.parse(storedData);
    if (storedDate !== today) {
      // New day â€” reset done status, keep tasks
      console.log("New day detected - resetting tasks");
      cards = cards.map(card => ({
        ...card,
        tasks: card.tasks.map(t => ({ ...t, done: false }))
      }));
      localStorage.setItem("ht-date", today);
      localStorage.setItem("ht-data", JSON.stringify(cards));
    }
    return cards;
  }
  // First time
  const initial = getInitialCards();
  localStorage.setItem("ht-date", today);
  localStorage.setItem("ht-data", JSON.stringify(initial));
  return initial;
}

function saveState(cards) {
  localStorage.setItem("ht-date", getTodayString());
  localStorage.setItem("ht-data", JSON.stringify(cards));
}

let cards = loadState();
let activeFormCardId = null;

// --- Render ---
function render() {
  const container = document.getElementById("cardsContainer");
  container.innerHTML = "";
  cards.forEach(card => {
    container.appendChild(renderCard(card));
  });
  updateProgress();
}

function renderCard(card) {
  const doneCount = card.tasks.filter(t => t.done).length;
  const total = card.tasks.length;
  const isComplete = total > 0 && doneCount === total;

  const cardEl = document.createElement("div");
  cardEl.className = "card" + (isComplete ? " complete" : "");

  // Header
  cardEl.innerHTML = `
    <div class="card-header" style="background: ${card.gradient};">
      <div class="card-header-left">
        <span class="card-emoji">${card.emoji}</span>
        <span class="card-title">${card.title}</span>
      </div>
      <span class="card-count">${doneCount}/${total}</span>
    </div>
    <div class="task-list" id="tasks-${card.id}"></div>
  `;

  const taskList = cardEl.querySelector(`#tasks-${card.id}`);

  // Tasks
  card.tasks.forEach(task => {
    taskList.appendChild(renderTask(card, task));
  });

  // Add task button or form
  if (activeFormCardId === card.id) {
    taskList.appendChild(renderAddForm(card));
  } else {
    const addBtn = document.createElement("button");
    addBtn.className = "add-task-btn";
    addBtn.style.setProperty("--accent", card.accent);
    addBtn.innerHTML = `<span class="plus">+</span> Add a task`;
    addBtn.addEventListener("click", () => {
      activeFormCardId = card.id;
      render();
      setTimeout(() => {
        const input = document.querySelector(`#add-input-${card.id}`);
        if (input) input.focus();
      }, 50);
    });
    taskList.appendChild(addBtn);
  }

  return cardEl;
}

function renderTask(card, task) {
  const item = document.createElement("div");
  item.className = "task-item" + (task.done ? " done" : "");

  item.innerHTML = `
    <div class="task-checkbox ${task.done ? "checked" : ""}" style="--accent: ${card.accent}; --accent-glow: ${card.accentGlow};">
      <svg width="13" height="13" viewBox="0 0 13 13" fill="none">
        <path d="M2 6.5L5.5 10L11 3" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </div>
    <span class="task-text">${escapeHtml(task.text)}</span>
    <div class="task-delete">Ã—</div>
  `;

  // Toggle on checkbox or text tap
  const checkbox = item.querySelector(".task-checkbox");
  const textEl = item.querySelector(".task-text");
  function toggle() {
    task.done = !task.done;
    saveState(cards);
    render();
  }
  checkbox.addEventListener("click", (e) => { e.stopPropagation(); toggle(); });
  textEl.addEventListener("click", toggle);

  // Delete
  item.querySelector(".task-delete").addEventListener("click", (e) => {
    e.stopPropagation();
    const cardData = cards.find(c => c.id === card.id);
    cardData.tasks = cardData.tasks.filter(t => t.id !== task.id);
    saveState(cards);
    render();
  });

  return item;
}

function renderAddForm(card) {
  const form = document.createElement("div");
  form.className = "add-task-form";
  form.style.setProperty("--accent", card.accent);
  form.style.setProperty("--accent-mid", card.accentMid);
  form.style.setProperty("--gradient", card.gradient);

  form.innerHTML = `
    <input type="text" id="add-input-${card.id}" class="add-task-input" placeholder="What's the task?" style="--accent: ${card.accent}; --accent-mid: ${card.accentMid};" />
    <button class="btn-add" style="background: ${card.gradient};">Add</button>
    <button class="btn-cancel">âœ•</button>
  `;

  const input = form.querySelector("input");
  const addBtn = form.querySelector(".btn-add");
  const cancelBtn = form.querySelector(".btn-cancel");

  function submitTask() {
    const val = input.value.trim();
    if (!val) return;
    const cardData = cards.find(c => c.id === card.id);
    cardData.tasks.push({ id: generateId(), text: val, done: false });
    saveState(cards);
    activeFormCardId = null;
    render();
  }

  input.addEventListener("keydown", (e) => {
    if (e.key === "Enter") submitTask();
    if (e.key === "Escape") { activeFormCardId = null; render(); }
  });
  addBtn.addEventListener("click", submitTask);
  cancelBtn.addEventListener("click", () => { activeFormCardId = null; render(); });

  return form;
}

function updateProgress() {
  const total = cards.reduce((s, c) => s + c.tasks.length, 0);
  const done = cards.reduce((s, c) => s + c.tasks.filter(t => t.done).length, 0);
  const pct = total > 0 ? Math.round((done / total) * 100) : 0;
  const isComplete = pct === 100;

  const valEl = document.getElementById("progressValue");
  valEl.textContent = pct + "%" + (isComplete ? " ðŸŽ‰" : "");
  valEl.className = "progress-value" + (isComplete ? " complete" : "");

  const fillEl = document.getElementById("progressFill");
  fillEl.style.width = pct + "%";
  fillEl.className = "progress-fill" + (isComplete ? " complete" : "");
}

// --- Date display ---
document.getElementById("dateDisplay").textContent = new Date().toLocaleDateString("en-US", {
  weekday: "long", month: "long", day: "numeric"
});

function escapeHtml(str) {
  const div = document.createElement("div");
  div.textContent = str;
  return div.innerHTML;
}

// Initial render
render();
</script>
</body>
</html>

